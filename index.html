<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>GenLayer Community Content Leaderboard</title>
    <link rel="icon" type="image/png" href="https://img.cryptorank.io/coins/gen_layer1758040081896.png">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#3b82f6",
                        "background-light": "#f5f5f8",
                        "background-dark": "#0f0f23",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
    </script>
    <style>
        body { background-color: #ffffff; }
        .loading { text-align: center; padding: 40px; color: #666; }
        .error { text-align: center; padding: 40px; color: #dc2626; }
    </style>
</head>
<body class="font-display text-gray-900">
<div class="relative flex min-h-screen w-full flex-col items-center bg-white group/design-root overflow-x-hidden">
<div class="w-full max-w-[1200px] px-4 sm:px-6 lg:px-8">
    <header class="flex items-center justify-center whitespace-nowrap py-6 border-b border-gray-200">
        <img src="logo.png" alt="GenLayer" class="h-12">
    </header>
    <main class="flex flex-col gap-8 py-8">
        <div class="flex flex-col gap-2 text-center">
            <p class="text-gray-900 text-4xl font-black tracking-[-0.033em]">Community Content Leaderboard</p>
            <p class="text-gray-600 text-lg">See who's at the top of their game.</p>
        </div>
        <div class="flex flex-col gap-3">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4 rounded-lg bg-gray-100 p-4 border border-gray-200">
                <div class="relative w-full md:w-auto md:flex-1">
                    <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">search</span>
                    <input id="search-input" class="w-full rounded-md border border-gray-300 bg-white py-2 pl-10 pr-4 text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-inset focus:ring-primary focus:border-primary" placeholder="Search by member name..." type="text"/>
                </div>
            </div>
            <div class="text-center text-sm text-gray-500">
                <span id="last-updated">Checking for updates...</span>
            </div>
        </div>
        <div class="flex flex-col gap-3">
            <div class="grid grid-cols-12 gap-2 px-4 py-2 text-sm font-medium text-gray-600 border-b border-gray-200">
                <div class="col-span-2 md:col-span-1">Rank</div>
                <div class="col-span-6 md:col-span-7">Member</div>
                <div class="col-span-4 text-right">XP</div>
            </div>
            <div class="flex flex-col gap-2" id="leaderboard-content">
                <div class="loading">Loading leaderboard...</div>
            </div>
            <div id="pagination"></div>
        </div>
    </main>
    <footer class="flex justify-center py-8 text-sm text-gray-600 border-t border-gray-200">
        <p>Created by Fortune Edwards for the GenLayer Community</p>
    </footer>
</div>
</div>

    <script>
        const SHEET_ID = '1CDvm-dRi1VTWROrcG4byqQSU_3nkyNPGRFeGA9KlXz0';

        async function fetchLeaderboard() {
            try {
                const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv`;
                const response = await fetch(url);
                const csvText = await response.text();
                
                const rows = csvText.split('\n').filter(row => row.trim());
                if (rows.length < 4) throw new Error('No data found');
                
                // Start from row 4 (index 3) and get columns B and C
                const members = rows.slice(3)
                    .map(row => {
                        const cols = row.split(',').map(cell => cell.replace(/"/g, '').trim());
                        return { name: cols[1] || 'Unknown', xp: parseInt(cols[2]) || 0 };
                    })
                    .filter(member => member.name !== 'Unknown')
                    .sort((a, b) => b.xp - a.xp);
                
                // Add original rank to each member
                const newMembers = members.map((member, index) => ({
                    ...member,
                    originalRank: index + 1
                }));
                
                // Check if data has actually changed
                const newDataHash = generateDataHash(newMembers);
                if (newDataHash !== previousDataHash) {
                    allMembers = newMembers;
                    if (previousDataHash === '') {
                        // First load
                        updateLastUpdated();
                    } else {
                        // Data changed
                        updateLastUpdated();
                    }
                    previousDataHash = newDataHash;
                } else {
                    allMembers = newMembers;
                    // Data unchanged - keep existing timestamp
                }
                
                displayLeaderboard(allMembers);
            } catch (error) {
                document.getElementById('leaderboard-content').innerHTML = 
                    `<div class="error">Error loading data: ${error.message}</div>`;
            }
        }


        function displayLeaderboard(members) {
            const paginatedMembers = paginateMembers(members, currentPage);
            const content = paginatedMembers.map((member) => {
                const rank = member.originalRank;
                let rankClass, iconClass, icon;
                
                if (rank === 1) {
                    rankClass = "bg-yellow-50 border-2 border-yellow-400 text-yellow-600";
                    icon = "trophy";
                } else if (rank === 2) {
                    rankClass = "bg-gray-50 border-2 border-gray-400 text-gray-600";
                    icon = "trophy";
                } else if (rank === 3) {
                    rankClass = "bg-orange-50 border-2 border-orange-400 text-orange-600";
                    icon = "trophy";
                } else {
                    rankClass = "bg-white border border-gray-200 hover:bg-gray-50 text-gray-700";
                }
                
                return `
                    <div class="grid grid-cols-12 items-center gap-2 rounded-lg p-4 transition-all hover:scale-[1.01] ${rankClass}">
                        <div class="col-span-2 md:col-span-1 flex items-center justify-center text-base font-bold">
                            ${rank <= 3 ? `<span class="material-symbols-outlined text-xl">${icon}</span>` : `<span>${rank}</span>`}
                        </div>
                        <div class="col-span-6 md:col-span-7 flex items-center gap-3">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm">
                                ${member.name.charAt(0).toUpperCase()}
                            </div>
                            <span class="font-semibold text-base text-gray-900 truncate">${member.name}</span>
                        </div>
                        <div class="col-span-4 text-right text-base font-bold text-gray-900">${member.xp.toLocaleString()}</div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('leaderboard-content').innerHTML = content;
            updatePagination(members);
        }

        let allMembers = [];
        let currentPage = 1;
        const membersPerPage = 50;
        let previousDataHash = '';
        
        function generateDataHash(members) {
            return JSON.stringify(members.map(m => ({name: m.name, xp: m.xp})));
        }
        
        function updateLastUpdated() {
            const now = new Date();
            const timeString = now.toLocaleString('en-GB', {
                day: '2-digit',
                month: '2-digit', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('last-updated').textContent = `Last updated: ${timeString}`;
        }
        
        function setInitialTimestamp() {
            if (previousDataHash === '') {
                updateLastUpdated();
            }
        }
        
        function filterMembers(searchTerm) {
            const filtered = allMembers.filter(member => 
                member.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            currentPage = 1;
            displayLeaderboard(filtered);
        }
        
        function paginateMembers(members, page) {
            const start = (page - 1) * membersPerPage;
            const end = start + membersPerPage;
            return members.slice(start, end);
        }
        
        function updatePagination(totalMembers) {
            const totalPages = Math.ceil(totalMembers.length / membersPerPage);
            const paginationHtml = `
                <div class="flex justify-center items-center gap-4 mt-6">
                    <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''} 
                        class="px-4 py-2 rounded-md bg-gray-800 text-white hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed">
                        Previous
                    </button>
                    <span class="text-gray-900">Page ${currentPage} of ${totalPages}</span>
                    <button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''} 
                        class="px-4 py-2 rounded-md bg-gray-800 text-white hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed">
                        Next
                    </button>
                </div>
            `;
            document.getElementById('pagination').innerHTML = paginationHtml;
        }
        
        function changePage(page) {
            const searchTerm = document.getElementById('search-input').value;
            const filtered = searchTerm ? 
                allMembers.filter(member => member.name.toLowerCase().includes(searchTerm.toLowerCase())) : 
                allMembers;
            
            const totalPages = Math.ceil(filtered.length / membersPerPage);
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            displayLeaderboard(filtered);
        }
        
        // Load leaderboard on page load
        fetchLeaderboard();

        
        // Search functionality
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', (e) => {
                filterMembers(e.target.value);
            });
            

        });
        
        // Refresh every 5 minutes
        setInterval(fetchLeaderboard, 300000);
    </script>
</body>
</html>